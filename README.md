# Match-3 Analyzer - 三消关卡“临界胜利点”分析器

三消游戏的主要盈利模式是让玩家在“还差一步”的时候卡关，引诱玩家购买“再加五步”的道具或者观看视频广告。这个项目不仅可以让你在线试玩多个预设的三消游戏关卡，更核心的功能是利用AI模拟来寻找每个关卡最关键的“临界胜利点”（Almost Win Point）。

"临界胜利点"指的是这样一个步数：在该步数下，玩家的胜率很低；但只要再增加几步，胜率就会出现显著的跃升。找到这个点，对于关卡设计师平衡游戏难度至关重要。

**[ 演示与使用说明 (How to Use) ]**

由于这是一个纯前端项目，您无需进行任何安装。只需在您的浏览器中打开 `match3.html` 文件即可开始使用。

https://github.com/user-attachments/assets/d7c37702-bb08-4983-aaf6-fef5fa2604ce

---

## 🌟 项目特色 (Features)

*   **AI驱动的关卡分析**：自动对三消关卡进行数千次模拟，以确定不同步数下的AI胜率。
*   **“临界胜利点”智能识别**：算法会自动寻找从“几乎不可能赢”到“有较高几率赢”的关键步数区间，并给出推荐步数。
*   **可复现的分析过程**：通过设置“分析种子”（Analysis Seed），您可以保证每次分析使用相同的随机序列，从而获得一致的测试结果。
*   **即时可玩的游戏模式**：在分析完成后，您可以直接使用AI建议的“临界”步数来亲自挑战该关卡，体验难度。
*   **内置多个示例关卡**：项目预置了4个设计各异的关卡，用于展示分析器的能力。
*   **纯粹的客户端技术**：整个项目仅依赖于HTML和原生JavaScript，无需任何后端服务或复杂的编译过程，极其轻便。

## 🎮 如何使用 (How to Use)

使用本工具非常简单，只需按照界面上的数字顺序操作即可：

1.  **选择一个关卡 (Select a Level)**：从下拉菜单中选择你感兴趣的关卡布局。选择后，右侧的游戏区域会立即展示该关卡的初始布局。
2.  **设置AI测试迭代次数 (Set AI Test Iterations)**：
    *   `50` (推荐): 速度最快，适合快速评估。
    *   `100` (标准): 结果更稳定，兼顾速度与准确性。
    *   `200` (彻底): 结果最精确，但耗时更长。
    *   `1` (单次运行): 用于调试或观察单局游戏流程。
3.  **(可选) 设置分析种子 (Set Analysis Seed)**：
    *   输入任意字符串（如 `torvalds`）作为种子，可以确保多次分析的结果完全一致。
    *   将输入框留空，则每次分析都会使用随机种子。
4.  **开始分析 (Find the "Almost Win" Point)**：点击此按钮。AI将开始从5步到40步，对每个步数进行指定迭代次数的模拟。分析日志会实时显示进度和胜率结果。
5.  **试玩关卡 (Play This Level)**：分析完成后，此按钮会被激活。它会显示AI计算出的推荐步数。点击它，即可进入游戏模式，用这个“刚刚好”的步数亲自挑战关卡。

## 🤖 工作原理 (How It Works)

本项目的核心在于 `Simulation` 和 `WeightedHeuristicAI` 这两个类。

1.  **模拟流程 (Simulation)**：
    *   当用户点击“运行分析”时，程序会针对一个步数范围（例如5到40步）进行循环。
    *   对于每一个步数，它会运行一个“批处理测试”（`runBatch`）。
    *   这个批处理会根据用户设定的迭代次数（如100次），创建100个独立的游戏实例。每个实例都使用一个基于主种子和迭代序号生成的独立PRNG（伪随机数生成器），以确保测试的可重复性和独立性。

2.  **AI决策 (Weighted Heuristic AI)**：
    *   在每一次模拟中，AI (`WeightedHeuristicAI`) 需要决定下一步怎么走。
    *   它的决策逻辑是“带权重的启发式”：
        1.  首先，找出所有可能的移动。
        2.  对于每一步移动，AI会“预演”一下：如果我这么走了，产生的新消除方块是否紧邻着任何一个目标（`📦`）？
        3.  所有能影响到目标的移动都被视为**优先移动 (Priority Moves)**。
        4.  AI会构建一个“决策池”，将每个优先移动放入池中10次，而其他普通移动只放入1次。
        5.  最后，AI从这个加权后的池中随机选择一个移动来执行。
    *   这种策略使得AI倾向于做出对完成目标最有帮助的移动，但又不完全丧失随机性，从而能更好地模拟普通玩家的行为。

3.  **结果分析 (Analysis)**：
    *   在所有步数的模拟都完成后，程序会分析胜率数据。
    *   它会寻找一个符合“**胜率从低于10%跃升到高于50%**”的区间，并将这个区间的起始步数作为“临界胜利点”推荐给用户。

## 🤝 贡献 (Contributing)

欢迎任何形式的贡献！如果您有新的关卡设计、AI策略改进建议，或是发现了任何bug，请随时提交Pull Request或开启一个Issue。

1.  Fork 本仓库
2.  创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3.  提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4.  推送到分支 (`git push origin feature/AmazingFeature`)
5.  开启一个 Pull Request

## 📜 许可证 (License)

本项目采用 MIT 许可证。详情请见 `LICENSE` 文件。
